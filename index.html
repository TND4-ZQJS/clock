<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Credit Card Enrolment PDF Filler</title>
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  h1 { color: #004080; }
  .section { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);}
  label { display: block; margin-top: 8px; font-weight: bold; }
  input[type="text"], input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 6px; margin-top: 3px; }
  .relationship-options { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
  .relationship-options label { font-weight: normal; }
  .policy-group { background: #f9f9f9; padding: 10px; margin-top: 10px; border-radius: 6px; }
  button { background: #004080; color: white; border: none; padding: 10px 20px; border-radius: 999px; cursor: pointer; font-size: 1rem; margin-right: 10px; }
  button:hover { background: #003366; }
  * { box-sizing: border-box; font-family: inherit; }

  /* Highlight effect for all inputs */
  input:focus, .card-digit-box.active {
    outline: 2px solid #004080;
    border-color: #004080;
    box-shadow: 0 0 4px rgba(0,64,128,0.5);
  }

  /* Card details row */
  .card-details-row {
    display: flex;
    align-items: center;
    gap: 16px;
    flex-wrap: wrap;
  }

  .card-number-container {
    display: flex;
    gap: 6px;
    align-items: center;
    cursor: text;
  }

  .card-digit-box {
    width: 34px;
    min-width: 34px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
    background: #fff;
  }

  .card-dash {
    font-size: 18px;
    font-weight: bold;
    padding: 0 2px;
  }

  #CardNumberInput {
    position: absolute;
    left: -9999px;
    width: 1px;
    height: 1px;
    opacity: 0;
    pointer-events: none;
  }

  .expiry-container {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .expiry-container input {
    width: 36px;
    min-width: 36px;
    height: 40px;
    padding: 0;
    border: 1px solid #ccc;
    border-radius: 4px;
    text-align: center;
    font-size: 16px;
  }

  @media (max-width: 420px) {
    .card-digit-box,
    .expiry-container input {
      width: 26px;
      min-width: 26px;
      height: 36px;
      font-size: 14px;
    }
    .expiry-container input { width: 28px; }
    .card-details-row { gap: 10px; }
  }
</style>
</head>
<body>

<h1>Credit Card Enrolment Form - PDF Filler</h1>

<form id="creditCardForm">

  <!-- Section B -->
  <div class="section">
    <h2>B. Card Details</h2>
    <label>Card Number & Expiry:</label>
    <div class="card-details-row" onclick="focusCardInput()">
      <div class="card-number-container" id="card-boxes">
        <!-- 4 groups of 4 digits -->
        <div class="card-digit-box" id="cardBox1"></div>
        <div class="card-digit-box" id="cardBox2"></div>
        <div class="card-digit-box" id="cardBox3"></div>
        <div class="card-digit-box" id="cardBox4"></div>
        <div class="card-dash">-</div>
        <div class="card-digit-box" id="cardBox5"></div>
        <div class="card-digit-box" id="cardBox6"></div>
        <div class="card-digit-box" id="cardBox7"></div>
        <div class="card-digit-box" id="cardBox8"></div>
        <div class="card-dash">-</div>
        <div class="card-digit-box" id="cardBox9"></div>
        <div class="card-digit-box" id="cardBox10"></div>
        <div class="card-digit-box" id="cardBox11"></div>
        <div class="card-digit-box" id="cardBox12"></div>
        <div class="card-dash">-</div>
        <div class="card-digit-box" id="cardBox13"></div>
        <div class="card-digit-box" id="cardBox14"></div>
        <div class="card-digit-box" id="cardBox15"></div>
        <div class="card-digit-box" id="cardBox16"></div>
      </div>

      <div class="expiry-container">
        <input type="text" name="CardExpry_M1" maxlength="1">
        <input type="text" name="CardExpry_M2" maxlength="1">
        <input type="text" name="CardExpry_Y1" maxlength="1">
        <input type="text" name="CardExpry_Y2" maxlength="1">
      </div>
    </div>
    <input type="text" id="CardNumberInput" maxlength="16" oninput="updateCardBoxes(this.value)">
  </div>

  <button type="button" onclick="fillPDF()">Fill & Download PDF</button>
  <button type="reset">Reset All</button>
</form>

<script>
function focusCardInput() {
  document.getElementById('CardNumberInput').focus();
}

function updateCardBoxes(value) {
  value = value.replace(/\D/g, '');
  if (value.length > 16) value = value.slice(0, 16);

  for (let i = 1; i <= 16; i++) {
    const box = document.getElementById(`cardBox${i}`);
    box.textContent = value[i - 1] || '';
  }

  // Auto jump after each 4 digits
  if ([4, 8, 12].includes(value.length)) {
    document.getElementById('CardNumberInput').setSelectionRange(value.length, value.length);
  }
}

// Expiry auto-tab
document.querySelectorAll('.expiry-container input').forEach((input, index, arr) => {
  input.addEventListener('input', () => {
    if (input.value.length === input.maxLength && index < arr.length - 1) {
      arr[index + 1].focus();
    }
  });
});

// Click highlight effect for boxes
document.querySelectorAll('.card-digit-box').forEach(box => {
  box.addEventListener('click', () => {
    focusCardInput();
    document.querySelectorAll('.card-digit-box').forEach(b => b.classList.remove('active'));
    box.classList.add('active');
  });
});

// Highlight effect for normal inputs
document.querySelectorAll('input').forEach(inp => {
  inp.addEventListener('focus', () => inp.classList.add('active'));
  inp.addEventListener('blur', () => inp.classList.remove('active'));
});

async function fillPDF(){
  const formUrl = 'CreditCardForm.pdf';
  const existingPdfBytes = await fetch(formUrl).then(res => res.arrayBuffer());
  const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
  const form = pdfDoc.getForm();
  const htmlForm = document.getElementById('creditCardForm');

  for (let el of htmlForm.elements){
    if(!el.name) continue;
    try {
      if(el.type === 'checkbox'){
        if(el.checked) form.getCheckBox(el.name).check();
        else form.getCheckBox(el.name).uncheck();
      }
      else if(el.type === 'radio'){
        if(el.checked){
          try { form.getRadioGroup(el.name).select(el.value); }
          catch { form.getCheckBox(el.value).check(); }
        }
      }
      else {
        form.getTextField(el.name).setText(el.value);
      }
    } catch(e){
      console.warn("Field not found in PDF:", el.name);
    }
  }

  const fullCardNumber = Array.from({ length: 16 }, (_, i) => {
    return document.getElementById(`cardBox${i + 1}`).textContent || '';
  }).join('');

  try {
    form.getTextField('CardNumber').setText(fullCardNumber);
  } catch (e) {
    console.warn("Combined card number field not found in PDF");
  }

  const pdfBytes = await pdfDoc.save({ updateFieldAppearances: true });
  const blob = new Blob([pdfBytes], {type: "application/pdf"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Filled_CreditCardForm.pdf';
  a.click();
}
</script>
</body>
</html>
