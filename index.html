<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Credit Card Enrolment PDF Filler</title>
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
  h1 { color: #004080; }
  .section { background: #fff; border-radius: 8px; padding: 15px; margin-bottom: 20px; box-shadow: 0 1px 4px rgba(0,0,0,0.1);}
  label { display: block; margin-top: 8px; font-weight: bold; }
  input[type="text"], input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 6px; margin-top: 3px; }
  .relationship-options { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 5px; }
  .relationship-options label { font-weight: normal; }
  .policy-group { background: #f9f9f9; padding: 10px; margin-top: 10px; border-radius: 6px; }
  button { background: #004080; color: white; border: none; padding: 10px 20px; border-radius: 999px; cursor: pointer; font-size: 1rem; margin-right: 10px; }
  button:hover { background: #003366; }
/* add near top of your stylesheet */
* { box-sizing: border-box; font-family: inherit; }

/* main container for card + expiry */
.card-details-row {
  display: flex;
  align-items: center;      /* vertical centering for all children */
  gap: 16px;
  flex-wrap: wrap;          /* allows wrapping on small screens */
}

/* visual boxes row (16 boxes) */
.card-number-container {
  display: flex;
  gap: 6px;
  align-items: center;      /* ensure each box centers its content vertically */
  cursor: text;             /* indicates clickable area */
}

/* each visual box */
.card-digit-box {
  width: 34px;              /* size of the box; tweak if you want bigger/smaller */
  min-width: 34px;
  height: 40px;             /* match the input height below */
  display: flex;
  align-items: center;      /* perfect vertical centering */
  justify-content: center;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 16px;
  line-height: 1;           /* not used because we use flex centering */
  background: #fff;
  box-shadow: none;
  padding: 0;
}

/* invisible actual typing input â€” keep it off-screen so it never affects layout */
#CardNumberInput {
  position: absolute;
  left: -9999px;
  top: auto;
  width: 1px;
  height: 1px;
  opacity: 0;
  pointer-events: none;
}

/* expiry area */
.expiry-container {
  display: flex;
  gap: 6px;
  align-items: center;      /* align with digit boxes */
}

/* make the expiry inputs visually identical to the boxes */
.expiry-container input {
  width: 36px;              /* slightly wider than boxes so the digit fits */
  min-width: 36px;
  height: 40px;             /* same height as .card-digit-box */
  padding: 0;
  border: 1px solid #ccc;
  border-radius: 4px;
  text-align: center;
  font-size: 16px;
  line-height: 1;
  box-shadow: none;
}

/* match the card bank / cardname spacing to align under card row */
.card-details-row + input[name="CardBank"],
.card-details-row + input[name="CardName"] {
  margin-top: 8px;
}

/* small-screen tweak: keep boxes on one row by shrinking sizes if necessary */
@media (max-width: 420px) {
  .card-digit-box,
  .expiry-container input {
    width: 26px;
    min-width: 26px;
    height: 36px;
    font-size: 14px;
  }
  .expiry-container input { width: 28px; }
  .card-details-row { gap: 10px; }
}
</style>
</head>
<body>

<h1>Credit Card Enrolment Form - PDF Filler</h1>

<form id="creditCardForm">

  <!-- Section A -->
  <div class="section">
    <h2>A. Premium Payment Instruction</h2>
    <label><input type="checkbox" name="CCAgree"> Recurring credit/debit card payments</label>
    <div class="inline-field">
      <label>One-time charge amount:</label>
      <input type="text" name="Onetimecharge_amt">
      <label><input type="checkbox" name="Onetimecharge_alloutstanding"> All outstanding</label>
      <label><input type="checkbox" name="Onetimecharge_tick"> One-time charge option</label>
    </div>
  </div>

  <!-- Section B -->
  <div class="section">
    <h2>B. Card Details</h2>
    <div class="inline-field">
      <label><input type="checkbox" name="CC_Tick"> Credit Card</label>
      <label><input type="checkbox" name="DebitC_Tick"> Debit Card</label>
      <label><input type="checkbox" name="Visa_Tick"> Visa</label>
      <label><input type="checkbox" name="Master_Tick"> MasterCard</label>
    </div>

    <label>Card Number & Expiry:</label>
    <div class="card-details-row" onclick="focusCardInput()">
      <div class="card-number-container">
        <div id="card-boxes">
          <script>
            for (let i = 1; i <= 16; i++) {
              document.write(`<div class="card-digit-box" id="cardBox${i}"></div>`);
            }
          </script>
        </div>
      </div>
      <div class="expiry-container">
        <input type="text" name="CardExpry_M1" placeholder="M1" maxlength="1">
        <input type="text" name="CardExpry_M2" placeholder="M2" maxlength="1">
        <input type="text" name="CardExpry_Y1" placeholder="Y1" maxlength="1">
        <input type="text" name="CardExpry_Y2" placeholder="Y2" maxlength="1">
      </div>
    </div>
    <input type="text" id="CardNumberInput" maxlength="16" oninput="updateCardBoxes(this.value)">

    <!-- Hidden PDF fields -->
    <div style="display:none;">
      <script>
        for (let i = 1; i <= 16; i++) {
          document.write(`<input type="hidden" name="CardNo_${i}" id="CardNo_${i}">`);
        }
      </script>
    </div>

    <label>Card Issuing Bank:</label>
    <input type="text" name="CardBank" class="full-width">
    <label>Cardholder Name:</label>
    <input type="text" name="CardName" class="full-width">
  </div>

  <!-- Section C -->
  <div class="section">
    <h2>C. Policy Details</h2>
    <script>
      const relationships = ["Ownself","spouse","children","Parent","Grandparent","Sibling","Company"];
      for (let i=1;i<=4;i++) {
        document.write('<div class="policy-group"><h3>Policy '+i+'</h3>');
        document.write('<div class="inline-field"><label>Policy No:</label><input type="text" name="PolicyNo'+i+'">');
        document.write('<label>Insured Name:</label><input type="text" name="Insured'+i+'"></div>');
        document.write('<label>Relationship:</label><div class="relationship-options">');
        relationships.forEach(r=>{
          document.write('<label><input type="radio" name="Relationship'+i+'" value="Relationship'+i+'_'+r+'"> '+r+'</label>');
        });
        document.write('</div></div>');
      }
    </script>
  </div>

  <!-- Section D -->
  <div class="section">
    <h2>D. Signatures & Payor Details</h2>
    <div class="inline-field">
      <label>Owner Name:</label><input type="text" name="Sign_OwnerName">
      <label>Owner IC No.:</label><input type="text" name="Sign_OwnerNIRC">
    </div>
    <div class="inline-field">
      <label>Payor Name:</label><input type="text" name="Sign_PayorName">
      <label>Payor IC No.:</label><input type="text" name="Sign_PayorNIRC">
    </div>
    <div class="inline-field">
      <label>Sign Date:</label><input type="text" name="Sign_Date" style="width:50px;">
      <label>Month:</label><input type="text" name="Sign_Month" style="width:50px;">
      <label>Year:</label><input type="text" name="Sign_Year" style="width:50px;">
      <label>State:</label><input type="text" name="Sign_State">
    </div>
  </div>

  <!-- Section E -->
  <div class="section">
    <h2>E. PDPA Consent</h2>
    <label><input type="checkbox" name="PDPA"> I agree to PDPA terms</label>
  </div>

  <button type="button" onclick="fillPDF()">Fill & Download PDF</button>
  <button type="reset">Reset All</button>
</form>

<script>
function focusCardInput() {
  document.getElementById('CardNumberInput').focus();
}

function updateCardBoxes(value) {
  value = value.replace(/\D/g, '');
  if (value.length > 16) value = value.slice(0, 16);
  for (let i = 1; i <= 16; i++) {
    document.getElementById(`cardBox${i}`).textContent = value[i - 1] || '';
    document.getElementById(`CardNo_${i}`).value = value[i - 1] || '';
  }
}

async function fillPDF(){
  const formUrl = 'CreditCardForm.pdf'; // Your PDF file
  const existingPdfBytes = await fetch(formUrl).then(res => res.arrayBuffer());
  const pdfDoc = await PDFLib.PDFDocument.load(existingPdfBytes);
  const form = pdfDoc.getForm();
  const htmlForm = document.getElementById('creditCardForm');
  const elements = htmlForm.elements;

  for(let el of elements){
    if(!el.name) continue;
    try {
      if(el.type === 'checkbox'){
        if(el.checked) form.getCheckBox(el.name).check();
        else form.getCheckBox(el.name).uncheck();
      }
      else if(el.type === 'radio'){
        if(el.checked) form.getCheckBox(el.value).check();
      }
      else {
        form.getTextField(el.name).setText(el.value);
      }
    } catch(e){
      console.warn("Field not found in PDF:", el.name);
    }
  }

  const pdfBytes = await pdfDoc.save({ updateFieldAppearances: true });
  const blob = new Blob([pdfBytes], {type: "application/pdf"});
  const url = URL.createObjectURL(blob);
  
  const a = document.createElement('a');
  a.href = url;
  a.download = 'Filled_CreditCardForm.pdf';
  a.click();
}
</script>

</body>
</html>
